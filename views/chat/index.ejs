<!-- views/chat/index.ejs -->

<div class="chat-container">
	<div class="sidebar">
		<h3>Chat</h3>
		<ul class="sidebar-list">
			<li class="sidebar-section b-border">
				<h5 class="toggle-section" data-target="friends-list"
					>Friends</h5
				>
				<ul class="sidebar-items d-none" id="friends-list">
					<% if (chat_friends.length === 0) { %>
					<li class="sidebar-item">No friends</li>
					<% } else { %> <% chat_friends.forEach(friend => { %>
					<li class="sidebar-item">
						<a href="/chat/friends/<%= friend.followed_id %>"
							><%= friend.username %></a
						>
					</li>
					<% }) %> <% } %>
				</ul>
			</li>

			<li class="sidebar-section b-border">
				<div class="d-flex justify-content-between">
					<h5 class="toggle-section w-100" data-target="rooms-list"
						>Rooms</h5
					>
					<span
						class="d-flex justify-content-between align-items-center"
						data-target="rooms-list"
					>
						<button
							id="open-room-modal"
							class="btn btn-sm btn-primary"
						>
							<i class="bi bi-plus-lg"></i>
						</button>
					</span>
				</div>
				<ul class="sidebar-items d-none" id="rooms-list">
					<% if (chat_rooms.length === 0) { %>
					<li class="sidebar-item">No rooms</li>
					<% } else { %> <% chat_rooms.forEach(room => { %>
					<li class="sidebar-item">
						<a href="/chat/rooms/<%= room.room_id %>"
							><%= room.name %></a
						>
					</li>
					<% }) %> <% } %>
				</ul>
			</li>

			<li class="sidebar-section b-border">
				<h5 class="toggle-section" data-target="projects-list"
					>Projects</h5
				>
				<ul class="sidebar-items d-none" id="projects-list">
					<% if (chat_projects.length === 0) { %>
					<li class="sidebar-item">No projects</li>
					<% } else { %> <% chat_projects.forEach(project => { %>
					<li class="sidebar-item">
						<a href="/chat/tasks/<%= project.id %>"
							><%= project.name %> (<%= project.type %>)</a
						>
					</li>
					<% }) %> <% } %>
				</ul>
			</li>
		</ul>
	</div>

	<div class="chat-window">
		<% if (projectName === 'chat_app') { %> <%-
		include('chat/partials/friends') %> <% } else if (projectName ===
		'chat_app_room') { %> <%- include('chat/partials/rooms') %> <% } else if
		(projectName === 'taskmanager') { %> <%-
		include('chat/partials/projects') %> <% } else { %>
		<p>Please select a chat to start messaging.</p>
		<% } %>
	</div>
</div>
<%- include('partials/room-modal') %>
<script>
	window.chatConfig = {
		roomId: '<%= receiverId %>',
		projectName: '<%= projectName %>',
		username: '<%= friend?.username || null %>',
	};
</script>
